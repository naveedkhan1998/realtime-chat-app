<!-- Sidebar Header -->
<div class="p-4 border-b border-gray-200 dark:border-gray-700">
    <div class="flex items-center justify-between">
        <a href="{% url 'htmx:chat_list' %}" class="flex items-center gap-2">
            <div class="w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center">
                <i data-lucide="message-circle" class="w-5 h-5 text-white"></i>
            </div>
            <span class="font-bold text-xl text-primary-600">ChatApp</span>
        </a>
        
        <div class="flex items-center gap-2">
            <!-- Theme Toggle -->
            <button @click="darkMode = !darkMode; localStorage.setItem('darkMode', darkMode)"
                    class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                <i x-show="!darkMode" data-lucide="moon" class="w-5 h-5"></i>
                <i x-show="darkMode" data-lucide="sun" class="w-5 h-5" x-cloak></i>
            </button>
            
            <!-- Close sidebar (mobile) -->
            <button @click="sidebarOpen = false" class="lg:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>
    </div>
</div>

<!-- User Profile Section -->
<div class="p-4 border-b border-gray-200 dark:border-gray-700" x-data="{ showMenu: false }">
    <div class="flex items-center gap-3">
        <div class="relative">
            {% if user.avatar %}
            <img src="{{ user.avatar.url }}" alt="{{ user.name }}" class="w-10 h-10 rounded-full object-cover">
            {% else %}
            <div class="w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center">
                <span class="text-primary-600 dark:text-primary-400 font-semibold">
                    {{ user.name|slice:":1"|upper }}
                </span>
            </div>
            {% endif %}
            <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full"></span>
        </div>
        
        <div class="flex-1 min-w-0">
            <p class="font-semibold truncate">{{ user.name }}</p>
            <p class="text-sm text-gray-500 dark:text-gray-400 truncate">{{ user.email }}</p>
        </div>
        
        <div class="relative">
            <button @click="showMenu = !showMenu" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                <i data-lucide="more-vertical" class="w-5 h-5"></i>
            </button>
            
            <!-- Dropdown Menu -->
            <div x-show="showMenu" 
                 @click.away="showMenu = false"
                 x-transition
                 class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-10"
                 x-cloak>
                <a href="{% url 'htmx:profile' %}" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <i data-lucide="user" class="w-4 h-4"></i>
                    Profile
                </a>
                <a href="{% url 'htmx:settings' %}" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                    Settings
                </a>
                <hr class="my-1 border-gray-200 dark:border-gray-700">
                <form action="{% url 'htmx:logout' %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="flex items-center gap-2 px-4 py-2 w-full text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                        Logout
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- New Chat Button -->
<div class="p-4">
    <a href="{% url 'htmx:new_chat' %}" 
       class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-colors">
        <i data-lucide="plus" class="w-5 h-5"></i>
        New Chat
    </a>
</div>

<!-- Chat List -->
<div class="flex-1 overflow-y-auto scrollbar-thin">
    <div class="px-4 py-2">
        <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">
            Messages
        </h3>
    </div>
    
    <div id="chat-list" 
         hx-get="{% url 'htmx:chat_list_partial' %}" 
         hx-trigger="load, chatListUpdated from:body"
         hx-swap="innerHTML">
        <!-- Chat list will be loaded here -->
        <div class="flex items-center justify-center py-8">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
        </div>
    </div>
</div>

<!-- Bottom Navigation -->
<div class="border-t border-gray-200 dark:border-gray-700 p-2">
    <div class="flex items-center justify-around">
        <a href="{% url 'htmx:chat_list' %}" class="flex flex-col items-center gap-1 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-primary-600">
            <i data-lucide="message-square" class="w-5 h-5"></i>
            <span class="text-xs">Chats</span>
        </a>
        <a href="{% url 'htmx:friends' %}" class="flex flex-col items-center gap-1 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400">
            <i data-lucide="users" class="w-5 h-5"></i>
            <span class="text-xs">Friends</span>
        </a>
        <a href="{% url 'htmx:notifications' %}" class="flex flex-col items-center gap-1 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 relative">
            <i data-lucide="bell" class="w-5 h-5"></i>
            <span class="text-xs">Alerts</span>
            <span id="notification-badge" class="hidden absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center"></span>
        </a>
    </div>
</div>
