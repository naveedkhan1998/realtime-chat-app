{% load static %}
<!DOCTYPE html>
<html lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true' }" :class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>{% block title %}MNK Chat - Realtime Messaging & Voice Huddles{% endblock %}</title>
    <meta name="description" content="Experience instant messaging, crystal-clear voice huddles, and smart offline-first notifications. Built with React, Django Channels, and WebRTC.">
    <meta name="keywords" content="realtime chat, open source, free chat app, django channels, react, webrtc, voice chat, websocket, redis">
    
    <!-- Favicons & App Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'site.webmanifest' %}">
    <link rel="icon" href="{% static 'favicon.ico' %}">
    <meta name="theme-color" content="#8b5cf6">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://chat.mnaveedk.com/">
    <meta property="og:title" content="MNK Chat - Realtime Messaging & Voice Huddles">
    <meta property="og:description" content="Experience instant messaging, crystal-clear voice huddles, and smart offline-first notifications. Built with React, Django Channels, and WebRTC.">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://chat.mnaveedk.com/">
    <meta property="twitter:title" content="MNK Chat - Realtime Messaging & Voice Huddles">
    <meta property="twitter:description" content="Experience instant messaging, crystal-clear voice huddles, and smart offline-first notifications. Built with React, Django Channels, and WebRTC.">
    
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS (compiled) -->
    <link rel="stylesheet" href="{% static 'css/output.css' %}">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/ws.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-background text-foreground min-h-screen antialiased">
    <!-- CSRF Token for HTMX -->
    <script>
        document.body.addEventListener('htmx:configRequest', function(evt) {
            evt.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
        });
    </script>
    
    {% block content %}{% endblock %}
    
    <!-- Toast Container -->
    <div id="toast-container" 
         x-data="toastManager()" 
         class="fixed bottom-4 right-4 z-50 flex flex-col gap-2"
         @show-toast.window="addToast($event.detail)">
        <template x-for="toast in toasts" :key="toast.id">
            <div x-show="toast.visible"
                 x-transition:enter="transform ease-out duration-300"
                 x-transition:enter-start="translate-y-2 opacity-0"
                 x-transition:enter-end="translate-y-0 opacity-100"
                 x-transition:leave="transform ease-in duration-200"
                 x-transition:leave-start="translate-y-0 opacity-100"
                 x-transition:leave-end="translate-y-2 opacity-0"
                 :class="{
                     'bg-green-500': toast.type === 'success',
                     'bg-destructive': toast.type === 'error',
                     'bg-primary': toast.type === 'info',
                     'bg-yellow-500': toast.type === 'warning'
                 }"
                 class="px-4 py-3 rounded-xl shadow-lg text-white flex items-center gap-2 min-w-[300px] backdrop-blur-sm">
                <span x-text="toast.message"></span>
                <button @click="removeToast(toast.id)" class="ml-auto hover:opacity-70">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
        </template>
    </div>
    
    <!-- Alpine.js Global Store -->
    <script>
        function toastManager() {
            return {
                toasts: [],
                addToast(detail) {
                    const id = Date.now();
                    this.toasts.push({
                        id,
                        message: detail.message,
                        type: detail.type || 'info',
                        visible: true
                    });
                    setTimeout(() => this.removeToast(id), 5000);
                },
                removeToast(id) {
                    const toast = this.toasts.find(t => t.id === id);
                    if (toast) {
                        toast.visible = false;
                        setTimeout(() => {
                            this.toasts = this.toasts.filter(t => t.id !== id);
                        }, 300);
                    }
                }
            }
        }
        
        // Current user ID for WebSocket handlers
        window.currentUserId = {{ user.id|default:'null' }};
        
        // Initialize Lucide icons after page load and after HTMX swaps
        document.addEventListener('DOMContentLoaded', () => lucide.createIcons());
        document.body.addEventListener('htmx:afterSwap', () => lucide.createIcons());
    </script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>
